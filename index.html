<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–°–º–∞—Ä—Ç—Ñ–æ–Ω—ã –≤ –ú–æ—Å–∫–≤–µ</title>

  <!-- Telegram WebApp -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 16px;
    }

    input, button {
      width: 100%;
      padding: 8px;
      margin: 6px 0;
    }

    ul {
      padding: 0;
    }

    li {
      list-style: none;
      border: 1px solid #ddd;
      padding: 8px;
      margin-bottom: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .delete {
      cursor: pointer;
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h2>üì± –°–º–∞—Ä—Ç—Ñ–æ–Ω—ã –≤ –ú–æ—Å–∫–≤–µ</h2>

  <p>–†–∞–∑–º–µ—Å—Ç–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ:</p>

  <form id="adForm">
    <input type="text" id="title" placeholder="–ú–æ–¥–µ–ª—å —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∞" required>
    <input type="number" id="price" placeholder="–¶–µ–Ω–∞ ‚ÇΩ" required>
    <input type="text" id="district" placeholder="–†–∞–π–æ–Ω" required>
    <button type="submit">–†–∞–∑–º–µ—Å—Ç–∏—Ç—å</button>
  </form>

  <h3>–û–±—ä—è–≤–ª–µ–Ω–∏—è:</h3>
  <ul id="adsList"></ul>

<script>
  // --- TELEGRAM ---
  const tg = window.Telegram?.WebApp;
  if (tg) {
    tg.ready();
    tg.expand();
  }

  const CURRENT_USER_ID = tg?.initDataUnsafe?.user?.id || "browser";

  // üî¥ –í–°–¢–ê–í–¨ –°–Æ–î–ê –°–í–û–ô URL APPS SCRIPT
  const API_URL = "https://script.google.com/macros/s/AKfycbxVpCmVYLj_V0LGdI8t6wJQ15kxM42H8MkvwWRCTocrS9jXUhOQ3Nvn_6Ayi7xwjEeVuw/exec";

  const adForm = document.getElementById("adForm");
  const adsList = document.getElementById("adsList");

  // --- –ó–ê–ì–†–£–ó–ö–ê –û–ë–™–Ø–í–õ–ï–ù–ò–ô ---
  function fetchAds() {
    fetch(API_URL)
      .then(res => res.json())
      .then(data => {
        adsList.innerHTML = "";

        data.forEach(ad => {
          const li = document.createElement("li");
          li.textContent = `${ad.title} ‚Äî ${ad.price} ‚ÇΩ ‚Äî ${ad.district}`;

          if (ad.userId == CURRENT_USER_ID) {
            const del = document.createElement("span");
            del.textContent = " ‚ùå";
            del.className = "delete";
            del.onclick = () => deleteAd(ad.id);
            li.appendChild(del);
          }

          adsList.appendChild(li);
        });
      });
  }

  // --- –î–û–ë–ê–í–õ–ï–ù–ò–ï ---
  adForm.addEventListener("submit", function(e) {
    e.preventDefault();

    fetch(API_URL, {
      method: "POST",
      body: new URLSearchParams({
        title: title.value,
        price: price.value,
        district: district.value,
        userId: CURRENT_USER_ID
      })
    }).then(() => {
      adForm.reset();
      fetchAds();
    });
  });

  // --- –£–î–ê–õ–ï–ù–ò–ï ---
  function deleteAd(id) {
    fetch(API_URL, {
      method: "POST",
      body: new URLSearchParams({
        action: "delete",
        id: id,
        userId: CURRENT_USER_ID
      })
    }).then(() => fetchAds());
  }

  // —Å—Ç–∞—Ä—Ç
  fetchAds();
</script>

</body>
</html>