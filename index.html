<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SmartMarket</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root {
  --bg: var(--tg-theme-bg-color, #f2f2f7);
  --card: var(--tg-theme-secondary-bg-color, #fff);
  --text: var(--tg-theme-text-color, #000);
  --hint: var(--tg-theme-hint-color, #8e8e93);
  --accent: var(--tg-theme-button-color, #007aff);
  --accent-text: var(--tg-theme-button-text-color, #fff);
}

body {
  margin: 0;
  padding: 16px;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
  background: var(--bg);
  color: var(--text);
}

h2 {
  margin-top: 0;
}

input, button {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: none;
  font-size: 16px;
  margin-bottom: 12px;
}

input {
  background: var(--card);
  color: var(--text);
}

button {
  background: var(--accent);
  color: var(--accent-text);
  font-weight: 600;
}

.tab {
  display: none;
}

.tab.active {
  display: block;
}

.tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 16px;
}

.tabs button {
  flex: 1;
  background: var(--card);
  color: var(--text);
}

.tabs button.active {
  background: var(--accent);
  color: var(--accent-text);
}
</style>
</head>

<body>

<div class="tabs">
  <button id="tabProfile" class="active">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
  <button id="tabAds">üì¶ –û–±—ä—è–≤–ª–µ–Ω–∏—è</button>
</div>

<div id="profile" class="tab active">
  <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>

  <input id="name" placeholder="–§–ò–û">
  <input id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
  <input id="username" disabled>

  <button onclick="saveProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>

<div id="ads" class="tab">
  <h2>–ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h2>
  <p style="color:var(--hint)">–†–∞–∑–¥–µ–ª –ø–æ—è–≤–∏—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ</p>
</div>

<script>
const tg = Telegram.WebApp;
tg.ready();
tg.expand();

const USER = tg.initDataUnsafe.user;
const USER_ID = USER.id;
const USERNAME = USER.username || "";

// üî¥ –í–°–¢–ê–í–¨ –°–Æ–î–ê URL
const API_URL = "https://script.google.com/macros/s/AKfycbwKJgT9fCS4i3P8dSD5kZZqtXVC25v5GFIT6a4BJRGMu1BE6Oi8XEPnRf8qk_mqfzylZQ/exec";

/* ===== TAB LOGIC ===== */
tabProfile.onclick = () => switchTab("profile", tabProfile);
tabAds.onclick = () => switchTab("ads", tabAds);

function switchTab(tabId, btn) {
  document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
  document.querySelectorAll(".tabs button").forEach(b => b.classList.remove("active"));
  document.getElementById(tabId).classList.add("active");
  btn.classList.add("active");
}

/* ===== LOAD USER ===== */
fetch(`${API_URL}?action=getUser&userId=${USER_ID}&username=${USERNAME}`)
  .then(r => r.json())
  .then(data => {
    name.value = data.name || "";
    phone.value = data.phone || "";
    username.value = "@" + (data.username || "");
  });

/* ===== SAVE USER ===== */
function saveProfile() {
  fetch(API_URL, {
    method: "POST",
    body: new URLSearchParams({
      action: "saveUser",
      userId: USER_ID,
      name: name.value,
      phone: phone.value,
      username: USERNAME
    })
  }).then(() => tg.showAlert("–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω"));
}
</script>

</body>
</html>